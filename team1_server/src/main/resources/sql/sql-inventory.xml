<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bitc.fullstack503.team1_server.mapper.InventoryMapper">
  <select id="selectEmployeeList" resultType="bitc.fullstack503.team1_server.dto.EmployeeDTO">
    SELECT i.image                                                                  AS 사진,
           i.name                                                                   AS 제품명,
           w.name                                                                   AS 보관위치,
           v.name                                                                   AS 거래처,
           SUM(CASE WHEN t.transaction = 0 THEN (t.after - t.before) ELSE 0 END)    AS 입고량,
           SUM(CASE WHEN t.transaction = 1 THEN (t.before - t.after) ELSE 0 END)    AS 출고량,
           SUM(CASE WHEN t.transaction = 2 THEN ABS(t.after - t.before) ELSE 0 END) AS 조정량,
           i.quantity                                                               AS 종료재고
    FROM item i
           JOIN
         warehouse w ON i.warehouse_name = w.name
           JOIN
         vendor v ON i.vendor_name = v.name
           LEFT JOIN
         transaction t ON i.idx = t.item_idx
    WHERE t.time BETWEEN '2025-05-07 00:00:00' AND '2025-05-07 23:59:59'
    GROUP BY i.idx, i.name, w.name, v.name, i.quantity, i.image
    ORDER BY i.name;
  </select>
</mapper>